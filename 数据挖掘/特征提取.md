项目背景：
• 小微商户可以向平台贷款；
• 商户会存在逾期还款甚⾄不还款的⾏为。
项目意义：减少贷款业务中出现坏账的可能性。
项目目标：
根据商户信息、信用记录和交易流⽔信息，预测该条贷款申请是否会出现30天逾期还款现象。

数据集介绍

• 2018年4月-2018年6月，商户的交易流⽔数据、贷款数据、还款数据等贷款数据：

贷款数据：

该表描述了贷款申请的详细信息以及标签。

• table_loan_train.txt
• table_loan_test.txt

列名comment
apply_id 贷款申请id
merchant_id 商户贷款id
apply_date 贷款申请时间
lend_amount 贷款⾦额
lend_period 贷款期数
is_30days_overdue 有⽆逾期30天还款现象（train）

apply_id,merchant_id,apply_date,lend_amount,lend_period
50557025,040407382055696,2018-05-14 00:00:00,3000.0,12

历史还款数据：

该表描述了历史贷款申请的详细信息以及标签。

• table_datamining_history_loan.txt

列名comment
apply_id 贷款申请id
merchant_id 贷款⼈id
apply_date 贷款申请时间
lend_amount 贷款⾦额
lend_period 贷款期数
notional_settle_date 理论结清日
real_settle_date 实际结清日
is_30days_overdue 有⽆逾期30天还款现象

apply_id,merchant_id,apply_date,lend_amount,lend_period,notional_settle_date,real_settle_date,is_30days_overdue
9664605,041973696425690,2017-03-08 00:00:00,20000.0,6,2017-09-10 00:00:00,2017-05-12 00:00:00,0

流水数据：

该表描述了交易流水的详细信息。

• table_loss_transaction_trainingdata.txt
• table_loss_transaction_testdata.txt
• table_lend_transaction_final.txt

列名comment
id 交易id
type 交易类型30-付款10-取消11-退款
status 状态0-创建2000-成功
store_id 门店id
merchant_id 商户id
pay_way ⼀级主支付⽅式
sub_pay_way ⼆级支付⽅式
paid_amount 消费者实际支付⾦额
ctime 创建时间
bankcard_credit 信用卡支付⾦额
bankcard_debit 储蓄卡支付⾦额
wallet_weixin 微信余额支付⾦额
wallet_alipay 支付宝余额支付⾦额
wallet_alipay_finance 支付宝余额宝支付⾦额
alipay_huabei 花呗支付⾦额
alipay_point 集分宝支付⾦额
pt 日期分区

id,type,status,store_id,merchant_id,pay_way,sub_pay_way,paid_amount,ctime,bankcard_credit,bankcard_debit,wallet_weixin,wallet_alipay,wallet_alipay_finance,alipay_huabei,alipay_point,pt
t7895258038171778,30,2000,152891338556931,733274352303974,3,3,486,1523704560899,486,0,0,0,0,0,0,20180414

抛出点数据：

这两张表描述了被抛出店铺的ID和抛出的时间。

• table_throwpoint_training.txt
• table_throwpoint_test.txt

列名comment
store_id 店铺ID
pt 抛出时间

store_id,pt
090203269514178,20180613

商户数据：

该表描述了商户的基本信息，包括：商户的⾏业，商户的省份。商户的⾏业和省份在⽂件中都用数字表示。

• table_datamining_merchant.txt

列名comment
merchant_id 商户ID
industry_level1 ⼀级⾏业[1,2,3]
province 省份[1,2,3]

merchant_id,industry_level1,province
967197052907468,2,1

请根据上述几张表的信息，给出项目数据分析所需要的特征，这些特征可结合多个列计算得出







1. **基础特征**：（从table_loan_train.txt中直接提取，根据贷款id区分）
    
    `lend_amount`：贷款金额
    
    `lend_period`：贷款期数

    `industry_level1`：商户的一级行业
    
    `province`：商户所在省份
    
2. **贷款申请相关特征**：（将table_loan_train.txt中的时间拆分成月份，小时，星期几）
    
    `apply_month`：贷款申请的月份（从`apply_date`提取）
    
    `apply_hour`：贷款申请的小时（从`apply_date`提取）
    
    `apply_dayofweek`：贷款申请的星期几（从`apply_date`提取）
    
3. **历史还款相关特征**：（从table_datamining_history_loan.txt提取）
    
    `previous_lend_amount`：历史贷款总金额（根据`merchant_id`聚合）
    
    `previous_lend_period`：历史平均贷款期数（根据`merchant_id`聚合）
    
    `previous_30days_overdue_count`：历史30天逾期次数（根据`merchant_id`聚合）
    
4. **交易流水相关特征**：（商户的交易流水上可能与贷款有关的特征）
    
    `transaction_count`：交易次数（根据`merchant_id`聚合）
    
    `transaction_amount_mean`：交易金额均值（根据`merchant_id`聚合）
    
    `transaction_amount_std`：交易金额标准差（根据`merchant_id`聚合）
    
    `credit_payment_ratio`：信用卡支付金额与总支付金额的比例（`bankcard_credit` / `paid_amount`）
    
    `huabei_payment_ratio`：花呗支付金额与总支付金额的比例（`alipay_huabei` / `paid_amount`）
    
5. **抛出店铺相关特征**：
    
    `throw_point_count`：被抛出店铺的次数（根据`merchant_id`聚合）
    
6. **贷款和还款日期相关特征**：
    
    `settle_days`：实际结清日期与理论结清日期的天数差（`real_settle_date` - `notional_settle_date`）

以下是特征提取的代码实现：

```python
import pandas as pd

# 读取数据
loan_train = pd.read_csv('table_loan_train.txt')
loan_test = pd.read_csv('table_loan_test.txt')
history_loan = pd.read_csv('table_datamining_history_loan.txt')
transaction_train = pd.read_csv('table_loss_transaction_trainingdata.txt')
transaction_test = pd.read_csv('table_loss_transaction_testdata.txt')
lend_transaction_final = pd.read_csv('table_lend_transaction_final.txt')
throwpoint_train = pd.read_csv('table_throwpoint_training.txt')
throwpoint_test = pd.read_csv('table_throwpoint_test.txt')
merchant = pd.read_csv('table_datamining_merchant.txt')

# 贷款申请相关特征
loan_train['apply_date'] = pd.to_datetime(loan_train['apply_date'])
loan_train['apply_month'] = loan_train['apply_date'].dt.month
loan_train['apply_hour'] = loan_train['apply_date'].dt.hour
loan_train['apply_dayofweek'] = loan_train['apply_date'].dt.dayofweek

# 历史还款相关特征
history_loan['settle_days'] = (pd.to_datetime(history_loan['real_settle_date']) - pd.to_datetime(history_loan['notional_settle_date'])).dt.days
history_loan_grouped = history_loan.groupby('merchant_id').agg({
    'lend_amount': 'sum',
    'lend_period': 'mean',
    'is_30days_overdue': 'sum',
    'settle_days': 'mean'
}).reset_index()
history_loan_grouped.rename(columns={
    'lend_amount': 'previous_lend_amount',
    'lend_period': 'previous_lend_period',
    'is_30days_overdue': 'previous_30days_overdue_count',
    'settle_days': 'previous_settle_days'
}, inplace=True)

# 交易流水相关特征
transaction_grouped = lend_transaction_final.groupby('merchant_id').agg({
    'id': 'count',
    'paid_amount': ['mean', 'std'],
    'bankcard_credit': lambda x: x.sum() / (x.sum() + x['bankcard_debit'].sum()),
    'alipay_huabei': lambda x: x.sum() / x['paid_amount'].sum()
}).reset_index()
transaction_grouped.columns = ['merchant_id', 'transaction_count', 'transaction_amount_mean', 'transaction_amount_std', 'credit_payment_ratio', 'huabei_payment_ratio']

# 抛出店铺相关特征
throwpoint_train['pt'] = pd.to_datetime(throwpoint_train['pt'])
throwpoint_train['throw_month'] = throwpoint_train['pt'].dt.month
throwpoint_train['throw_hour'] = throwpoint_train['pt'].dt.hour
throwpoint_train['throw_dayofweek'] = throwpoint_train['pt'].dt.dayofweek
throwpoint_grouped = throwpoint_train.groupby('store_id').size().reset_index(name='throw_point_count')

# 合并特征
train_data = pd.merge(loan_train, merchant, on='merchant_id', how='left')
train_data = pd.merge(train_data, history_loan_grouped, on='merchant_id', how='left')
train_data = pd.merge(train_data, transaction_grouped, on='merchant_id', how='left')
train_data = pd.merge(train_data, throwpoint_grouped, on='merchant_id', how='left')

test_data = pd.merge(loan_test, merchant, on='merchant_id', how='left')
test_data = pd.merge(test_data, history_loan_grouped, on='merchant_id', how='left')
test_data = pd.merge(test_data, transaction_grouped, on='merchant_id', how='left')
test_data = pd.merge(test_data, throwpoint_grouped, on='merchant_id', how='left')

# 保存特征工程后的数据
train_data.to_csv('train_features.csv', index=False)
test_data.to_csv('test_features.csv', index=False)
```

这段代码会生成包含特征的新数据集`train_features.csv`和`test_features.csv`，这些特征可以用于后续的模型训练。